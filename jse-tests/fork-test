#!/bin/jse --shell-script

/**
 * Its possible to fork with jse, but you cannot get any data out of the fork using normal
 * Javascript methods. You will need some form of IPC synchronization if your child processes,
 * need to report back to the main.
 */

loadPlugin("Fork.jso");

var data = [1,2,3].toBuffer(Int8);

var k = new Fork(this, function main(mem){
	/* the function of child */
	mem[0] = 25;
	printErrorLine("child: going to sleep for 5 seconds.")
	sleep(5000);
	printErrorLine("child: woke-up; task-complete: "+mem[0]);
	return "this should be void";
}, data /* optional child function main parameters may follow ...*/);

printErrorLine("parent: waiting for child to finish...");

// loadPlugin('Fork.jso') provides this function
wait(k);

printErrorLine("parent: child has finished"); // EVIL!!! DATA WAS NOT MODIFIED

if (k.result !== undefined) {
	printErrorLine("parent: got a child result: "+k.result);
}
